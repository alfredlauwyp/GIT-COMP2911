import java.util.LinkedList;
import java.util.Comparator;
import java.util.PriorityQueue;
import java.lang.StringBuffer;
import java.util.ArrayList;

/**
 * Implements Breadth First Search Algorithm
 * @author Hayden Smith
 *
 */
public class Asearch<JobPoint> {

	@SuppressWarnings("unchecked")
	public Asearch(Graph graph)
	{
		this.graph = graph;
		this.allNodes = graph.getNodes();
	}
	
	public LinkedList<JobPoint> findPath(JobPoint initialNodeObj, Comparator<AsearchNode<JobPoint>> comp)
	{
		// Establish path to take
		LinkedList<JobPoint> path = new LinkedList<JobPoint>();
		PriorityQueue<AsearchNode<JobPoint>> priorityQueue = new PriorityQueue<AsearchNode<JobPoint>>(INITIAL_QUEUE_CAPACITY, comp);
		
		if (allNodes.size() > 0)
		{
			AsearchNode<JobPoint> current = new AsearchNode<JobPoint>(initialNodeObj, 0);
			priorityQueue.add(current);
			
			boolean visitedAll = false;
			
			@SuppressWarnings("unchecked")
			ArrayList<JobPoint> neighbours = null;
			
			while (!priorityQueue.isEmpty() && !visitedAll)
			{
				current = priorityQueue.poll();
				if (current.getNumNodesVisited() < this.graph.getNumVertices())
				{
					current.addVisited(current);
				    
					neighbours = graph.getNeighbours(current.getNodeObj());
				    for(E currentNeighbour : neighbours)
				    {
				    	if (!current.hasVisited(currentNeighbour))
				    	{
				    		JobPoint temp = (JobPoint)current.getNodeObj();
				    		int distanceDifference = temp.getExternalDistanceTo((JobPoint)currentNeighbour);
				    		
				    		int travelled = (current.getDistanceTravelled() + distanceDifference);
							AsearchNode<JobPoint> nodeToAdd = new AsearchNode(currentNeighbour, travelled);
				    		
				    		for(AsearchNode<JobPoint> alreadyVisited : current.getNodesVisited())
				    		{
				    			nodeToAdd.addVisited(alreadyVisited);
				    		}
				    		priorityQueue.add(nodeToAdd);
				    	}
				    }
				}
				else
				{
					visitedAll = true;
				}
			}
			
			if(current.getNumNodesVisited() == this.graph.getNumVertices()) {
				path = current.getNodeObjsVisited();
			}			 
		}
		return path;		
	}
		
	private Graph graph;
	private ArrayList<ArrayList<JobPoint>> allNodes;
	private static final int INITIAL_QUEUE_CAPACITY = 100;

}
